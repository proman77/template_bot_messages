–í–æ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ñ–∞–π–ª `PROJECT_PLAN.md`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–µ–Ω—å —Å–≤–æ–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. –û–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (–∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã), —á—Ç–æ–±—ã –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤ –∫–æ–¥.

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ –ø–æ–Ω—è—Ç–Ω—ã–µ —ç—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

***

# PROJECT_PLAN.md: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram-–±–æ—Ç —Å –°–∏—Å—Ç–µ–º–æ–π –†–∞—Å—Å—ã–ª–æ–∫ (Microservices)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ Telegram-–±–æ—Ç–∞. –û—Å–Ω–æ–≤–Ω–æ–π —É–ø–æ—Ä —Å–¥–µ–ª–∞–Ω –Ω–∞ –Ω–∞–¥–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—Å—ã–ª–æ–∫ (Broadcast Pipeline) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ—á–µ—Ä–µ–¥–µ–π.

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫

*   **–Ø–¥—Ä–æ:** Python 3.11+
*   **–ë–æ—Ç:** `aiogram 3.x`, `aiogram-dialog`, `fluentogram`
*   **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:** `taskiq`, `taskiq-nats`, `taskiq-redis`
*   **–ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π:** NATS (JetStream)
*   **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL + `sqlalchemy` (async) + `psycopg` + `alembic`
*   **–ö—ç—à / FSM:** Redis + `ormsgpack` (–¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
*   **–ö–æ–Ω—Ñ–∏–≥:** `dynaconf`

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É "Monorepo style", –≥–¥–µ –∫–æ–¥ –±–æ—Ç–∞ –∏ –≤–æ—Ä–∫–µ—Ä–æ–≤ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ, –Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–∑–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏ –≤—Ö–æ–¥–∞.

```text
.
‚îú‚îÄ‚îÄ deploy/                  # Docker-compose –∏ Dockerfiles
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml   # NATS, Redis, Postgres
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                 # –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ (Entrypoints)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.py           # –ó–∞–ø—É—Å–∫ Polling/Webhook
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ worker.py        # –ó–∞–ø—É—Å–∫ Taskiq Worker
‚îÇ   ‚îú‚îÄ‚îÄ bot/                 # –õ–æ–≥–∏–∫–∞ Telegram (UI —Å–ª–æ–π)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dialogs/         # –°—Ü–µ–Ω–∞—Ä–∏–∏ (Aiogram-dialog)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middlewares/     # DI, User Tracking, i18n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ structures/      # FSM States, Keyboards
‚îÇ   ‚îú‚îÄ‚îÄ core/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py        # Dynaconf settings
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py        # Pydantic DTOs
‚îÇ   ‚îú‚îÄ‚îÄ database/            # –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö (Postgres)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/      # Alembic scripts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/          # SQLAlchemy Table definitions
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repo/            # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (CRUD)
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/      # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ broker.py        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Taskiq + NATS
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db_factory.py    # SQLAlchemy engine/session
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redis_factory.py # Redis client
‚îÇ   ‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Bot API)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ broadcast.py     # –õ–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∫–æ–π
‚îÇ   ‚îî‚îÄ‚îÄ tasks/               # –ó–∞–¥–∞—á–∏ –¥–ª—è Taskiq
‚îÇ       ‚îú‚îÄ‚îÄ broadcast_tasks.py # Loader –∏ Sender
‚îÇ       ‚îî‚îÄ‚îÄ system_tasks.py
‚îú‚îÄ‚îÄ locales/                 # –§–∞–π–ª—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (.ftl)
‚îú‚îÄ‚îÄ alembic.ini
‚îú‚îÄ‚îÄ pyproject.toml
‚îî‚îÄ‚îÄ README.md
```

---

## üöÄ –≠—Ç–∞–ø—ã –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Roadmap)

### –≠—Ç–∞–ø 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –ë–∞–∑–∞ (Foundation)
**–¶–µ–ª—å:** –ü–æ–¥–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î.

1.  **Docker Compose:**
    *   –ü–æ–¥–Ω—è—Ç—å `PostgreSQL` (port 5432).
    *   –ü–æ–¥–Ω—è—Ç—å `Redis` (port 6379).
    *   –ü–æ–¥–Ω—è—Ç—å `NATS` (port 4222) —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º JetStream (`-js`).
2.  **Database Core:**
    *   –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `SQLAlchemy` (AsyncEngine) + `psycopg`.
    *   –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `Alembic`.
3.  **–ú–æ–¥–µ–ª—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`User`):**
    *   –ü–æ–ª—è: `telegram_id` (BigInt, Index), `username`, `fullname`, `language_code`, `created_at`.
    *   **–í–∞–∂–Ω–æ:** –ü–æ–ª–µ `is_active` (Boolean, default=True) ‚Äî –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

### –≠—Ç–∞–ø 2: –Ø–¥—Ä–æ –ë–æ—Ç–∞ –∏ –£—á–µ—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–¶–µ–ª—å:** –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

1.  **Aiogram Setup:** –ë–∞–∑–æ–≤—ã–π `Dispatcher` –∏ `Bot`.
2.  **User Tracking Middleware:**
    *   –ù–∞–ø–∏—Å–∞—Ç—å –º–∏–¥–ª–≤–∞—Ä—å, –∫–æ—Ç–æ—Ä–∞—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ *–ª—é–±–æ–µ* —Å–æ–æ–±—â–µ–Ω–∏–µ.
    *   –õ–æ–≥–∏–∫–∞: `INSERT ON CONFLICT DO UPDATE SET updated_at = NOW(), is_active = True`.
3.  **Chat Member Handler:**
    *   –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è `my_chat_member`.
    *   –ï—Å–ª–∏ `new_chat_member.status` == `kicked` -> —Å—Ç–∞–≤–∏–º `is_active = False` –≤ –ë–î.
    *   –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è —á–∏—Å—Ç–∫–∏ –±–∞–∑—ã –ø–µ—Ä–µ–¥ —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏.

### –≠—Ç–∞–ø 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Taskiq –∏ NATS
**–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á.

1.  **Broker Setup (`src/infrastructure/broker.py`):**
    *   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `NatsBroker`.
    *   –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `ormsgpack` –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å–∫–æ—Ä–æ—Å—Ç—å).
    *   –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ `RedisAsyncResultBackend` (—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤).
2.  **–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞:**
    *   –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É `print_hello`.
    *   –í—ã–∑–≤–∞—Ç—å –µ—ë –∏–∑ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –±–æ—Ç–∞: `await print_hello.kiq()`.
    *   –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∞ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –≤–æ—Ä–∫–µ—Ä–∞.

### –≠—Ç–∞–ø 4: –°–∏—Å—Ç–µ–º–∞ –†–∞—Å—Å—ã–ª–æ–∫ (Broadcast Engine) ‚Äî MVP
**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–π–ø–ª–∞–π–Ω —Ä–∞—Å—Å—ã–ª–∫–∏.

#### 1. –ú–æ–¥–µ–ª–∏ –î–∞–Ω–Ω—ã—Ö (`src/database/models/broadcast.py`)
–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã:
*   `BroadcastCampaign`: `id`, `admin_id`, `status` (created, pending, sending, completed, paused), `scheduled_at`.
*   `BroadcastMessage`: `id`, `campaign_id`, `language_code`, `content_type`, `file_id`, `text`, `caption`.

#### 2. –ê–¥–º–∏–Ω–∫–∞ (Aiogram-dialog)
*   **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞:** –ê–¥–º–∏–Ω –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É.
*   **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:** –ë–æ—Ç –ø–∞—Ä—Å–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ `BroadcastMessage` (–∏—Å–ø–æ–ª—å–∑—É–µ–º `copy_message` –ª–æ–≥–∏–∫—É).
*   **–ó–∞–ø—É—Å–∫:** –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É" –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–∞–º–ø–∞–Ω–∏–∏ –Ω–∞ `pending`.

#### 3. Taskiq: –ó–∞–≥—Ä—É–∑—á–∏–∫ (The Loader)
*   –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É `start_broadcast_task(campaign_id)`.
*   **–õ–æ–≥–∏–∫–∞:**
    1.  –°—Ç–∞–≤–∏—Ç —Å—Ç–∞—Ç—É—Å `sending`.
    2.  –ß–∏—Ç–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ë–î —á–∞–Ω–∫–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ 1000) —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫—É—Ä—Å–æ—Ä.
    3.  –î–ª—è –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ª–µ–≥–∫–∏–π payload: `{"user_id": 123, "camp_id": 55}`.
    4.  –ö–∏–¥–∞–µ—Ç —ç—Ç–æ—Ç payload –≤ NATS (–≤—ã–∑–æ–≤ –∑–∞–¥–∞—á–∏ `send_one_message`).

#### 4. Taskiq: –†–∞—Å—Å—ã–ª—å—â–∏–∫ (The Sender)
*   –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É `send_one_message(user_id, camp_id)`.
*   **–õ–æ–≥–∏–∫–∞:**
    1.  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç Redis: –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –∫–∞–º–ø–∞–Ω–∏–∏ `paused`, –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
    2.  –î–æ—Å—Ç–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫—ç—à–∞ (–∏–ª–∏ –ë–î).
    3.  `await bot.copy_message(...)`.
    4.  **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
        *   `TelegramForbiddenError` -> `db.users.update(is_active=False)`.
        *   `TelegramRetryAfter` -> `await asyncio.sleep(retry_after)`.

### –≠—Ç–∞–ø 5: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
**–¶–µ–ª—å:** –î–∞—Ç—å –∞–¥–º–∏–Ω—É –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º.

1.  **Redis Counters:**
    *   –í `Loader`: –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –∫–ª—é—á–∞ `broadcast:{id}:total`.
    *   –í `Sender`: –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –∫–ª—é—á–µ–π `...:success` –∏–ª–∏ `...:fail`.
2.  **Live Status:**
    *   –í –∞–¥–º–∏–Ω–∫–µ –¥–∏–∞–ª–æ–≥–∞ –≤—ã–≤–æ–¥–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Ü–∏—Ñ—Ä—ã –∏–∑ Redis –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
3.  **–ö–Ω–æ–ø–∫–∞ –ü–∞—É–∑—ã:**
    *   –ê–¥–º–∏–Ω –∂–º–µ—Ç "–ü–∞—É–∑–∞" -> –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –ë–î –∏ Redis.
    *   –í–æ—Ä–∫–µ—Ä—ã –ø–µ—Ä–µ—Å—Ç–∞—é—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤

*   [ ] **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ormsgpack` –≤ Taskiq Broker config.
*   [ ] **Dependency Injection:** –í–Ω–µ–¥—Ä—è—Ç—å `SQLAlchemy Session` –∏ `Bot` –∏–Ω—Å—Ç–∞–Ω—Å –≤ –∑–∞–¥–∞—á–∏ Taskiq —á–µ—Ä–µ–∑ `TaskiqMiddleware` –∏–ª–∏ `broker.add_dependency_context`.
*   [ ] **Rate Limiting:** –£—á–µ—Å—Ç—å –ª–∏–º–∏—Ç—ã Telegram (30 msg/sec). –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `rate_limits` –≤–Ω—É—Ç—Ä–∏ Taskiq, –Ω–æ NATS + –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ –º–æ–≥—É—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç. –†–µ—à–µ–Ω–∏–µ: `aiogram` –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ —Ç—Ä–æ—Ç—Ç–ª–∏–Ω–≥–∞, –ª–∏–±–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤.
*   [ ] **Graceful Shutdown:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤–æ—Ä–∫–µ—Ä –¥–æ–¥–µ–ª—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∑–∞–¥–∞—á—É.

## üìå –ü—Ä–∏–º–µ—Ä Payload –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ (NATS)

–≠—Ç–æ —Ç–æ, —á—Ç–æ –ª–µ—Ç–∞–µ—Ç –º–µ–∂–¥—É –ó–∞–≥—Ä—É–∑—á–∏–∫–æ–º –∏ –†–∞—Å—Å—ã–ª—å—â–∏–∫–æ–º. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ.

```json
{
  "task_name": "send_one_message",
  "args": [],
  "kwargs": {
    "user_id": 49210421,
    "chat_id": 49210421,
    "content_id": 502,
    "language": "ru"
  }
}
```

---
*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –û–±–Ω–æ–≤–ª—è–π—Ç–µ –µ–≥–æ –ø–æ –º–µ—Ä–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.*