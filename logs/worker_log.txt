[2025-12-26 17:31:22,216][taskiq.worker][INFO   ][MainProcess] Pid of a main process: 6744
[2025-12-26 17:31:22,216][taskiq.worker][INFO   ][MainProcess] Starting 1 worker processes.
[2025-12-26 17:31:22,223][taskiq.process-manager][INFO   ][MainProcess] Started process worker-0 with pid 15624 
[2025-12-26 17:31:29,341][taskiq.worker][INFO   ][worker-0] Importing tasks from module app.services.scheduler.tasks
[2025-12-26 17:31:29,394][app.services.scheduler.taskiq_broker][INFO   ][worker-0] \U0001f680 WORKER STARTUP EVENT TRIGGERED! Initializing dependencies...
[2025-12-26 17:31:29,755][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:31:29,755][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:31:30,841][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:31:30,842][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:31:32,988][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:31:33,002][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:31:37,284][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:31:37,321][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:31:45,860][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:31:45,955][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:31:59,771][app.infrastructure.database.connection.connect_to_pg][ERROR  ][worker-0] Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:31:59,831][app.services.scheduler.taskiq_broker][ERROR  ][worker-0] \u274c Failed to initialize database pool: couldn't get a connection after 30.00 sec
[2025-12-26 17:31:59,842][taskiq.worker][WARNING][worker-0] Shutting down the broker.
[2025-12-26 17:31:59,846][taskiq.worker][WARNING][worker-0] Exception found while shutting down broker: Client.connect must be called first
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 46, in shutdown_broker
    ret_val = await asyncio.wait_for(broker.shutdown(), timeout)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 507, in wait_for
    return await fut
           ^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 160, in shutdown
    await self.client.close()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 718, in close
    await self._close(Client.CLOSED)
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 727, in _close
    await self._flush_pending()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 1289, in _flush_pending
    assert self._flush_queue, "Client.connect must be called first"
           ^^^^^^^^^^^^^^^^^
AssertionError: Client.connect must be called first
Process worker-0:
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:32:00,181][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-scheduler' coro=<AsyncScheduler.run() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\sched_async.py:69> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001983C94AC40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:32:00,184][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-0' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001983C94AD40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:32:00,186][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-1' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001983C94AE40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:32:00,188][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-2' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
[2025-12-26 17:32:01,368][taskiq.process-manager][INFO   ][MainProcess] worker-0 is dead. Scheduling reload.
[2025-12-26 17:32:02,374][taskiq.process-manager][INFO   ][MainProcess] Process worker-0 restarted with pid 18044
[2025-12-26 17:32:07,924][taskiq.worker][INFO   ][worker-0] Importing tasks from module app.services.scheduler.tasks
[2025-12-26 17:32:08,058][app.services.scheduler.taskiq_broker][INFO   ][worker-0] \U0001f680 WORKER STARTUP EVENT TRIGGERED! Initializing dependencies...
[2025-12-26 17:32:08,387][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:08,387][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:09,357][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:09,362][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:11,288][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:11,312][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:15,127][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:15,210][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:22,810][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:23,010][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:38,163][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:38,404][app.infrastructure.database.connection.connect_to_pg][ERROR  ][worker-0] Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:32:38,460][app.services.scheduler.taskiq_broker][ERROR  ][worker-0] \u274c Failed to initialize database pool: couldn't get a connection after 30.00 sec
[2025-12-26 17:32:38,471][taskiq.worker][WARNING][worker-0] Shutting down the broker.
[2025-12-26 17:32:38,474][taskiq.worker][WARNING][worker-0] Exception found while shutting down broker: Client.connect must be called first
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 46, in shutdown_broker
    ret_val = await asyncio.wait_for(broker.shutdown(), timeout)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 507, in wait_for
    return await fut
           ^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 160, in shutdown
    await self.client.close()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 718, in close
    await self._close(Client.CLOSED)
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 727, in _close
    await self._flush_pending()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 1289, in _flush_pending
    assert self._flush_queue, "Client.connect must be called first"
           ^^^^^^^^^^^^^^^^^
AssertionError: Client.connect must be called first
Process worker-0:
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:32:38,766][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-scheduler' coro=<AsyncScheduler.run() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\sched_async.py:69> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001C37B8D2C40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:32:38,770][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-0' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001C37B8D2D40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:32:38,771][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-1' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001C37B8D2E40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:32:38,773][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-2' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
[2025-12-26 17:32:39,498][taskiq.process-manager][INFO   ][MainProcess] worker-0 is dead. Scheduling reload.
[2025-12-26 17:32:40,502][taskiq.process-manager][INFO   ][MainProcess] Process worker-0 restarted with pid 21524
[2025-12-26 17:32:46,082][taskiq.worker][INFO   ][worker-0] Importing tasks from module app.services.scheduler.tasks
[2025-12-26 17:32:46,102][app.services.scheduler.taskiq_broker][INFO   ][worker-0] \U0001f680 WORKER STARTUP EVENT TRIGGERED! Initializing dependencies...
[2025-12-26 17:32:46,557][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:46,557][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:47,504][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:47,552][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:49,383][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:49,541][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:53,132][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:32:53,516][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:00,625][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:01,462][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:15,594][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:16,559][app.infrastructure.database.connection.connect_to_pg][ERROR  ][worker-0] Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:33:16,572][app.services.scheduler.taskiq_broker][ERROR  ][worker-0] \u274c Failed to initialize database pool: couldn't get a connection after 30.00 sec
[2025-12-26 17:33:16,575][taskiq.worker][WARNING][worker-0] Shutting down the broker.
[2025-12-26 17:33:16,576][taskiq.worker][WARNING][worker-0] Exception found while shutting down broker: Client.connect must be called first
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 46, in shutdown_broker
    ret_val = await asyncio.wait_for(broker.shutdown(), timeout)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 507, in wait_for
    return await fut
           ^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 160, in shutdown
    await self.client.close()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 718, in close
    await self._close(Client.CLOSED)
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 727, in _close
    await self._flush_pending()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 1289, in _flush_pending
    assert self._flush_queue, "Client.connect must be called first"
           ^^^^^^^^^^^^^^^^^
AssertionError: Client.connect must be called first
Process worker-0:
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:33:16,765][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-scheduler' coro=<AsyncScheduler.run() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\sched_async.py:69> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001A122692C40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:33:16,767][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-0' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001A122692D40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:33:16,768][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-1' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001A122692E40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:33:16,770][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-2' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
[2025-12-26 17:33:17,631][taskiq.process-manager][INFO   ][MainProcess] worker-0 is dead. Scheduling reload.
[2025-12-26 17:33:18,640][taskiq.process-manager][INFO   ][MainProcess] Process worker-0 restarted with pid 6376
[2025-12-26 17:33:23,946][taskiq.worker][INFO   ][worker-0] Importing tasks from module app.services.scheduler.tasks
[2025-12-26 17:33:23,971][app.services.scheduler.taskiq_broker][INFO   ][worker-0] \U0001f680 WORKER STARTUP EVENT TRIGGERED! Initializing dependencies...
[2025-12-26 17:33:24,295][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:24,296][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:25,368][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:25,384][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:27,499][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:27,550][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:31,739][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:31,880][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:40,220][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:40,549][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:33:54,308][app.infrastructure.database.connection.connect_to_pg][ERROR  ][worker-0] Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:33:54,356][app.services.scheduler.taskiq_broker][ERROR  ][worker-0] \u274c Failed to initialize database pool: couldn't get a connection after 30.00 sec
[2025-12-26 17:33:54,362][taskiq.worker][WARNING][worker-0] Shutting down the broker.
[2025-12-26 17:33:54,365][taskiq.worker][WARNING][worker-0] Exception found while shutting down broker: Client.connect must be called first
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 46, in shutdown_broker
    ret_val = await asyncio.wait_for(broker.shutdown(), timeout)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 507, in wait_for
    return await fut
           ^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 160, in shutdown
    await self.client.close()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 718, in close
    await self._close(Client.CLOSED)
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 727, in _close
    await self._flush_pending()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 1289, in _flush_pending
    assert self._flush_queue, "Client.connect must be called first"
           ^^^^^^^^^^^^^^^^^
AssertionError: Client.connect must be called first
Process worker-0:
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:33:54,962][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-scheduler' coro=<AsyncScheduler.run() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\sched_async.py:69> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x00000155980A2C40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:33:54,974][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-0' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x00000155980A2D40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:33:54,977][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-1' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x00000155980A2E40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:33:54,985][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-2' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
[2025-12-26 17:33:55,764][taskiq.process-manager][INFO   ][MainProcess] worker-0 is dead. Scheduling reload.
[2025-12-26 17:33:56,774][taskiq.process-manager][INFO   ][MainProcess] Process worker-0 restarted with pid 15820
[2025-12-26 17:34:02,373][taskiq.worker][INFO   ][worker-0] Importing tasks from module app.services.scheduler.tasks
[2025-12-26 17:34:02,413][app.services.scheduler.taskiq_broker][INFO   ][worker-0] \U0001f680 WORKER STARTUP EVENT TRIGGERED! Initializing dependencies...
[2025-12-26 17:34:03,054][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:03,055][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:04,128][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:04,129][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:06,274][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:06,275][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:10,541][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:10,559][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:19,078][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:19,113][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:33,065][app.infrastructure.database.connection.connect_to_pg][ERROR  ][worker-0] Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:34:33,072][app.services.scheduler.taskiq_broker][ERROR  ][worker-0] \u274c Failed to initialize database pool: couldn't get a connection after 30.00 sec
[2025-12-26 17:34:33,073][taskiq.worker][WARNING][worker-0] Shutting down the broker.
[2025-12-26 17:34:33,073][taskiq.worker][WARNING][worker-0] Exception found while shutting down broker: Client.connect must be called first
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 46, in shutdown_broker
    ret_val = await asyncio.wait_for(broker.shutdown(), timeout)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 507, in wait_for
    return await fut
           ^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 160, in shutdown
    await self.client.close()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 718, in close
    await self._close(Client.CLOSED)
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 727, in _close
    await self._flush_pending()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 1289, in _flush_pending
    assert self._flush_queue, "Client.connect must be called first"
           ^^^^^^^^^^^^^^^^^
AssertionError: Client.connect must be called first
Process worker-0:
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:34:33,198][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-scheduler' coro=<AsyncScheduler.run() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\sched_async.py:69> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x00000173A70A2C40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:34:33,202][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-0' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x00000173A70A2D40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:34:33,205][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-1' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x00000173A70A2E40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:34:33,207][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-2' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
[2025-12-26 17:34:33,896][taskiq.process-manager][INFO   ][MainProcess] worker-0 is dead. Scheduling reload.
[2025-12-26 17:34:34,901][taskiq.process-manager][INFO   ][MainProcess] Process worker-0 restarted with pid 16248
[2025-12-26 17:34:40,770][taskiq.worker][INFO   ][worker-0] Importing tasks from module app.services.scheduler.tasks
[2025-12-26 17:34:40,821][app.services.scheduler.taskiq_broker][INFO   ][worker-0] \U0001f680 WORKER STARTUP EVENT TRIGGERED! Initializing dependencies...
[2025-12-26 17:34:41,272][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:41,273][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:42,288][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:42,312][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:44,309][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:44,362][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:48,357][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:48,470][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:56,434][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:34:56,665][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:11,289][app.infrastructure.database.connection.connect_to_pg][ERROR  ][worker-0] Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:35:11,387][app.services.scheduler.taskiq_broker][ERROR  ][worker-0] \u274c Failed to initialize database pool: couldn't get a connection after 30.00 sec
[2025-12-26 17:35:11,406][taskiq.worker][WARNING][worker-0] Shutting down the broker.
[2025-12-26 17:35:11,412][taskiq.worker][WARNING][worker-0] Exception found while shutting down broker: Client.connect must be called first
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 46, in shutdown_broker
    ret_val = await asyncio.wait_for(broker.shutdown(), timeout)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 507, in wait_for
    return await fut
           ^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 160, in shutdown
    await self.client.close()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 718, in close
    await self._close(Client.CLOSED)
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 727, in _close
    await self._flush_pending()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 1289, in _flush_pending
    assert self._flush_queue, "Client.connect must be called first"
           ^^^^^^^^^^^^^^^^^
AssertionError: Client.connect must be called first
Process worker-0:
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:35:11,886][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-scheduler' coro=<AsyncScheduler.run() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\sched_async.py:69> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001F95C8F2C40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:35:11,893][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-0' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001F95C8F2D40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:35:11,896][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-1' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001F95C8F2E40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:35:11,898][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-2' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
[2025-12-26 17:35:13,030][taskiq.process-manager][INFO   ][MainProcess] worker-0 is dead. Scheduling reload.
[2025-12-26 17:35:14,035][taskiq.process-manager][INFO   ][MainProcess] Process worker-0 restarted with pid 7100
[2025-12-26 17:35:20,150][taskiq.worker][INFO   ][worker-0] Importing tasks from module app.services.scheduler.tasks
[2025-12-26 17:35:20,178][app.services.scheduler.taskiq_broker][INFO   ][worker-0] \U0001f680 WORKER STARTUP EVENT TRIGGERED! Initializing dependencies...
[2025-12-26 17:35:20,751][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:20,752][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:21,755][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:21,755][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:23,745][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:23,745][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:27,704][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:27,734][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:35,606][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:35,689][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:50,799][app.infrastructure.database.connection.connect_to_pg][ERROR  ][worker-0] Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:35:50,909][app.services.scheduler.taskiq_broker][ERROR  ][worker-0] \u274c Failed to initialize database pool: couldn't get a connection after 30.00 sec
[2025-12-26 17:35:50,920][taskiq.worker][WARNING][worker-0] Shutting down the broker.
[2025-12-26 17:35:50,922][taskiq.worker][WARNING][worker-0] Exception found while shutting down broker: Client.connect must be called first
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 46, in shutdown_broker
    ret_val = await asyncio.wait_for(broker.shutdown(), timeout)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 507, in wait_for
    return await fut
           ^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 160, in shutdown
    await self.client.close()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 718, in close
    await self._close(Client.CLOSED)
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 727, in _close
    await self._flush_pending()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 1289, in _flush_pending
    assert self._flush_queue, "Client.connect must be called first"
           ^^^^^^^^^^^^^^^^^
AssertionError: Client.connect must be called first
Process worker-0:
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:35:51,283][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-scheduler' coro=<AsyncScheduler.run() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\sched_async.py:69> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x0000021D6E292C40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:35:51,286][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-0' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x0000021D6E292D40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:35:51,287][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-1' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x0000021D6E292E40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:35:51,288][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-2' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
[2025-12-26 17:35:52,178][taskiq.process-manager][INFO   ][MainProcess] worker-0 is dead. Scheduling reload.
[2025-12-26 17:35:53,182][taskiq.process-manager][INFO   ][MainProcess] Process worker-0 restarted with pid 15692
[2025-12-26 17:35:58,148][taskiq.worker][INFO   ][worker-0] Importing tasks from module app.services.scheduler.tasks
[2025-12-26 17:35:58,171][app.services.scheduler.taskiq_broker][INFO   ][worker-0] \U0001f680 WORKER STARTUP EVENT TRIGGERED! Initializing dependencies...
[2025-12-26 17:35:58,428][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:58,429][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:59,450][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:35:59,496][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:01,493][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:01,617][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:05,584][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:05,856][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:13,742][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:14,327][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:28,432][app.infrastructure.database.connection.connect_to_pg][ERROR  ][worker-0] Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:36:28,444][app.services.scheduler.taskiq_broker][ERROR  ][worker-0] \u274c Failed to initialize database pool: couldn't get a connection after 30.00 sec
[2025-12-26 17:36:28,445][taskiq.worker][WARNING][worker-0] Shutting down the broker.
[2025-12-26 17:36:28,446][taskiq.worker][WARNING][worker-0] Exception found while shutting down broker: Client.connect must be called first
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 46, in shutdown_broker
    ret_val = await asyncio.wait_for(broker.shutdown(), timeout)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 507, in wait_for
    return await fut
           ^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 160, in shutdown
    await self.client.close()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 718, in close
    await self._close(Client.CLOSED)
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 727, in _close
    await self._flush_pending()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 1289, in _flush_pending
    assert self._flush_queue, "Client.connect must be called first"
           ^^^^^^^^^^^^^^^^^
AssertionError: Client.connect must be called first
Process worker-0:
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:36:28,767][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-scheduler' coro=<AsyncScheduler.run() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\sched_async.py:69> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001A98F492C40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:36:28,770][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-0' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001A98F492D40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:36:28,772][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-1' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x000001A98F492E40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:36:28,773][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-2' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
[2025-12-26 17:36:29,306][taskiq.process-manager][INFO   ][MainProcess] worker-0 is dead. Scheduling reload.
[2025-12-26 17:36:30,309][taskiq.process-manager][INFO   ][MainProcess] Process worker-0 restarted with pid 21704
[2025-12-26 17:36:37,328][taskiq.worker][INFO   ][worker-0] Importing tasks from module app.services.scheduler.tasks
[2025-12-26 17:36:37,359][app.services.scheduler.taskiq_broker][INFO   ][worker-0] \U0001f680 WORKER STARTUP EVENT TRIGGERED! Initializing dependencies...
[2025-12-26 17:36:37,732][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:37,732][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:38,650][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:38,704][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:40,481][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:40,644][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:44,150][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:44,530][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:51,480][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:36:52,278][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:06,122][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:07,751][app.infrastructure.database.connection.connect_to_pg][ERROR  ][worker-0] Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:37:07,794][app.services.scheduler.taskiq_broker][ERROR  ][worker-0] \u274c Failed to initialize database pool: couldn't get a connection after 30.00 sec
[2025-12-26 17:37:07,802][taskiq.worker][WARNING][worker-0] Shutting down the broker.
[2025-12-26 17:37:07,803][taskiq.worker][WARNING][worker-0] Exception found while shutting down broker: Client.connect must be called first
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 46, in shutdown_broker
    ret_val = await asyncio.wait_for(broker.shutdown(), timeout)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 507, in wait_for
    return await fut
           ^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 160, in shutdown
    await self.client.close()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 718, in close
    await self._close(Client.CLOSED)
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 727, in _close
    await self._flush_pending()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 1289, in _flush_pending
    assert self._flush_queue, "Client.connect must be called first"
           ^^^^^^^^^^^^^^^^^
AssertionError: Client.connect must be called first
[2025-12-26 17:37:07,822][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
Process worker-0:
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:37:07,950][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-scheduler' coro=<AsyncScheduler.run() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\sched_async.py:69> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x0000012A34F72C40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:37:07,952][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-0' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x0000012A34F72D40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:37:07,953][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-1' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x0000012A34F72E40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:37:07,955][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-2' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
[2025-12-26 17:37:08,442][taskiq.process-manager][INFO   ][MainProcess] worker-0 is dead. Scheduling reload.
[2025-12-26 17:37:09,447][taskiq.process-manager][INFO   ][MainProcess] Process worker-0 restarted with pid 6128
[2025-12-26 17:37:15,958][taskiq.worker][INFO   ][worker-0] Importing tasks from module app.services.scheduler.tasks
[2025-12-26 17:37:15,982][app.services.scheduler.taskiq_broker][INFO   ][worker-0] \U0001f680 WORKER STARTUP EVENT TRIGGERED! Initializing dependencies...
[2025-12-26 17:37:16,355][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:16,356][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:17,341][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:17,417][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:19,289][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:19,538][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:23,180][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:23,780][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:30,957][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:32,256][psycopg.pool][WARNING][worker-0] error connecting in 'pool-1': Psycopg cannot use the 'ProactorEventLoop' to run in async mode. Please use a compatible event loop, for instance by running 'asyncio.run(..., loop_factory=asyncio.SelectorEventLoop(selectors.SelectSelector()))'
[2025-12-26 17:37:46,359][app.infrastructure.database.connection.connect_to_pg][ERROR  ][worker-0] Failed to initialize PostgreSQL pool: couldn't get a connection after 30.00 sec
Traceback (most recent call last):
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:37:46,380][app.services.scheduler.taskiq_broker][ERROR  ][worker-0] \u274c Failed to initialize database pool: couldn't get a connection after 30.00 sec
[2025-12-26 17:37:46,382][taskiq.worker][WARNING][worker-0] Shutting down the broker.
[2025-12-26 17:37:46,383][taskiq.worker][WARNING][worker-0] Exception found while shutting down broker: Client.connect must be called first
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 46, in shutdown_broker
    ret_val = await asyncio.wait_for(broker.shutdown(), timeout)  # type: ignore
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\tasks.py", line 507, in wait_for
    return await fut
           ^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 160, in shutdown
    await self.client.close()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 718, in close
    await self._close(Client.CLOSED)
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 727, in _close
    await self._flush_pending()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\nats\aio\client.py", line 1289, in _flush_pending
    assert self._flush_queue, "Client.connect must be called first"
           ^^^^^^^^^^^^^^^^^
AssertionError: Client.connect must be called first
Process worker-0:
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\cli\worker\run.py", line 175, in start_listen
    loop.run_until_complete(receiver.listen(shutdown_event))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\receiver\receiver.py", line 316, in listen
    await self.broker.startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq_nats\broker.py", line 148, in startup
    await super().startup()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\abc\broker.py", line 194, in startup
    await maybe_awaitable(handler(self.state))
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\taskiq\utils.py", line 30, in maybe_awaitable
    return await possible_coroutine
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 100, in startup
    raise e
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\services\scheduler\taskiq_broker.py", line 89, in startup
    db_pool = await get_pg_pool(
              ^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\proman_esp\Programing\template_bot_messages\app\infrastructure\database\connection\connect_to_pg.py", line 88, in get_pg_pool
    async with db_pool.connection() as connection:
               ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 216, in connection
    conn = await self.getconn(timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 251, in getconn
    raise PoolTimeout(
        f"couldn't get a connection after {timeout:.2f} sec"
    ) from None
psycopg_pool.PoolTimeout: couldn't get a connection after 30.00 sec
[2025-12-26 17:37:46,778][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-scheduler' coro=<AsyncScheduler.run() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\sched_async.py:69> wait_for=<Future pending cb=[Task.task_wakeup()]>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x0000021BE4702C40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:37:46,782][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-0' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x0000021BE4702D40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:37:46,784][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-1' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
Exception ignored in: <coroutine object AsyncConnectionPool.worker at 0x0000021BE4702E40>
Traceback (most recent call last):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py", line 660, in worker
    if isinstance((task := (await q.get())), StopWorker):
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\queues.py", line 188, in get
    getter.cancel()  # Just in case getter is not done yet.
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
  File "C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
[2025-12-26 17:37:46,786][asyncio][ERROR  ][worker-0] Task was destroyed but it is pending!
task: <Task pending name='pool-1-worker-2' coro=<AsyncConnectionPool.worker() done, defined at C:\Users\proman_esp\AppData\Local\Programs\Python\Python313\Lib\site-packages\psycopg_pool\pool_async.py:650> wait_for=<Future cancelled>>
[2025-12-26 17:37:47,572][taskiq.process-manager][INFO   ][MainProcess] worker-0 is dead. Scheduling reload.
[2025-12-26 17:37:48,575][taskiq.process-manager][INFO   ][MainProcess] Process worker-0 restarted with pid 19452
