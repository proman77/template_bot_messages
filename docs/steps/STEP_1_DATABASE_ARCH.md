–í–æ—Ç **–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è** –¥–ª—è –≠—Ç–∞–ø–∞ 1. –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç *—á—Ç–æ* –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∏ *–∫–∞–∫–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º* —ç—Ç–æ –¥–æ–ª–∂–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å, –Ω–µ —Å–ø—É—Å–∫–∞—è—Å—å –¥–æ —É—Ä–æ–≤–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞.

–ï–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ (–¢–ó) –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏–ª–∏ –∫–∞–∫ —á–µ–∫-–ª–∏—Å—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞.

***

# STEP_1_DATABASE_ARCH.md: –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –°–ª–æ—è –î–∞–Ω–Ω—ã—Ö ‚Äî ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

–í —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ –æ–ø–∏—Å–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —è–¥—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—Å—ã–ª–æ–∫ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

## üéØ –¶–µ–ª–∏ —ç—Ç–∞–ø–∞
1.  –û–±–µ—Å–ø–µ—á–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –°–£–ë–î –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (High Concurrency).
2.  –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É—á–µ—Ç–æ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π Telegram API.
3.  –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º—ã –ë–î (–º–∏–≥—Ä–∞—Ü–∏–∏).

---

## 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î (Database Core)

### 1.1. –î—Ä–∞–π–≤–µ—Ä –∏ –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä
*   **–¢–∏–ø –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:** –°—Ç—Ä–æ–≥–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π (Asynchronous). –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –¥—Ä–∞–π–≤–µ—Ä–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç Event Loop –±–æ—Ç–∞.
*   **–î—Ä–∞–π–≤–µ—Ä:** `psycopg` (–≤–µ—Ä—Å–∏–∏ 3.x).
*   **ORM:** `SQLAlchemy` (–≤–µ—Ä—Å–∏–∏ 2.0+). –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å.

### 1.2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ (Connection Pooling)
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—É–ª–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ PostgreSQL.
*   **Pool Size:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π), –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –¥–ª—è —à—Ç–∞—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞.
*   **Max Overflow:** –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, +10).
*   **Session Management:**
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∞–±—Ä–∏–∫—É —Å–µ—Å—Å–∏–π (`sessionmaker`).
    *   –°–µ—Å—Å–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏.
    *   –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫–ª—é—á–∏—Ç—å `expire_on_commit` –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–¥–∞—á–∞ –æ–±—ä–µ–∫—Ç–∞ –≤ –∑–∞–¥–∞—á—É Taskiq).

### 1.3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
*   –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ö–æ—Å—Ç, –ø–æ—Ä—Ç, –ª–æ–≥–∏–Ω, –ø–∞—Ä–æ–ª—å, –∏–º—è –ë–î) –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∂–µ—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –≤ –∫–æ–¥–µ.
*   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ DSN (Data Source Name) –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ `.env` —Ñ–∞–π–ª–æ–≤.

---

## 2. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ú–æ–¥–µ–ª–∏ –î–∞–Ω–Ω—ã—Ö: `User`

–¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî —Å–∞–º–∞—è –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ. –û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥—è—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Ä–∞—Å—Å—ã–ª–∫–µ.

### 2.1. –ê—Ç—Ä–∏–±—É—Ç—ã (–ü–æ–ª—è)

| –õ–æ–≥–∏—á–µ—Å–∫–æ–µ –∏–º—è | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –ë–î | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- | :--- |
| **Internal ID** | Integer (Auto-increment) | Primary Key | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Å–≤—è–∑–µ–π (FK). |
| **Telegram ID** | **BigInteger** | Unique, Not Null, Index | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram. **–í–∞–∂–Ω–æ:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ 64-–±–∏—Ç–Ω–æ–µ —á–∏—Å–ª–æ, —Ç–∞–∫ –∫–∞–∫ ID –≤ TG –ø—Ä–µ–≤—ã—à–∞—é—Ç –ª–∏–º–∏—Ç—ã –æ–±—ã—á–Ω–æ–≥–æ Int. |
| **Username** | String / Varchar | Nullable | –ù–∏–∫–Ω–µ–π–º (@username). –ú–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å. |
| **Full Name** | String / Varchar | Not Null | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. |
| **Language** | String (–∫–æ–¥ ISO) | Default='ru' | –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è i18n. |
| **Is Active** | **Boolean** | Default=True, Index | –§–ª–∞–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏. `True` ‚Äî –±–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω, `False` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—Å—ã–ª–∫–∏. |
| **Created At** | Timestamp | Default=NOW() | –î–∞—Ç–∞ –ø–µ—Ä–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. |
| **Updated At** | Timestamp | Auto-update | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. |

### 2.2. –ò–Ω–¥–µ–∫—Å—ã
*   –ò–Ω–¥–µ–∫—Å –Ω–∞ `telegram_id`: –î–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`SELECT ... WHERE telegram_id = ?`) –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥—è—â–µ–º –∞–ø–¥–µ–π—Ç–µ.
*   –ò–Ω–¥–µ–∫—Å –Ω–∞ `is_active`: –î–ª—è –±—ã—Å—Ç—Ä–æ–π –≤—ã–±–æ—Ä–∫–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Ä–∞—Å—Å—ã–ª–∫–∏ (`SELECT ... WHERE is_active = True`).

---

## 3. –°–∏—Å—Ç–µ–º–∞ –ú–∏–≥—Ä–∞—Ü–∏–π (Schema Versioning)

### 3.1. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π
*   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Alembic`.

### 3.2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
*   **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** Env-—Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –¥–≤–∏–∂–∫–æ–º SQLAlchemy.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** `alembic.ini` –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π –∫ –ë–î. URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ –æ–±—â–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –º–∏–≥—Ä–∞—Ü–∏–π.
*   **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥–µ–ª–µ–π —Ç–∞–∫, —á—Ç–æ–±—ã Alembic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Python-–∫–æ–¥–µ –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π (`--autogenerate`).

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ü—Ä–∏–µ–º–∫–∏ (Definition of Done)

1.  [x] –°–ª–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `src/database`).
2.  [x] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ PostgreSQL, –∑–∞–ø—É—â–µ–Ω–Ω–æ–º—É –≤ Docker.
3.  [x] –°–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è, —Å–æ–∑–¥–∞—é—â–∞—è —Ç–∞–±–ª–∏—Ü—É `users`.
4.  [x] –ú–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π `upgrade head`.
5.  [x] –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (–æ—Å–æ–±–µ–Ω–Ω–æ `BigInt` –¥–ª—è Telegram ID).
6.  [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –º–æ–¥–µ–ª–µ–π —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø–æ–ª—è–º–∏ –≤—Ä–µ–º–µ–Ω–∏ (`created_at`, `updated_at`).
